<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulação do PDE 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #003562;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 320px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -160px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .tooltip .tooltiptext table {
            width: 100%;
        }
        .tooltip .tooltiptext th, .tooltip .tooltiptext td {
            border: 1px solid #ddd;
            padding: 4px;
        }
        .tooltip .tooltiptext th {
            background-color: #666;
        }
        /* Custom radio button styles */
        .custom-radio-container {
            display: flex;
            gap: 1rem;
        }
        .custom-radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 0.375rem;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .custom-radio-label input {
            display: none;
        }
        .custom-radio-label:has(input:checked) {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-[#003562] text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold">Simulação do PDE 2025</h1>
            <img src="https://sme-upge.github.io/pde-2025/logo-sme.png" alt="Logo da Secretaria Municipal de Educação" class="w-40 md:w-52" onerror="this.onerror=null; this.src='https://placehold.co/200x50/003562/FFFFFF?text=Logo+SME';">
        </div>
    </header>

    <main class="container mx-auto p-4">
        <div class="bg-blue-100 p-6 rounded-lg shadow-lg">

            <!-- Seções de Seleção Inicial -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div>
                    <label for="cargo" class="block text-lg font-semibold mb-2">Qual o seu cargo?</label>
                    <select id="cargo" class="w-full p-3 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500">
                        <option value="1">Professor(a)</option>
                        <option value="2">Diretor(a) de Escola</option>
                        <option value="3">Assistente de Diretor(a) de Escola</option>
                        <option value="4">Coordenador(a) Pedagógico(a)</option>
                        <option value="5">Supervisor(a) Escolar</option>
                        <option value="6">Outros</option>
                    </select>
                </div>
                <div>
                    <label for="localTrabalho" class="block text-lg font-semibold mb-2">Onde você trabalha?</label>
                    <select id="localTrabalho" class="w-full p-3 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500">
                        <option value="1">EMEF/EMEFM</option>
                        <option value="2">EMEI/CEMEI</option>
                        <option value="3">CEI</option>
                        <option value="4">CIEJA</option>
                        <option value="5">EMEBS/CMCT/Gestão do CEU</option>
                        <option value="6">Diretoria Regional de Educação</option>
                        <option value="7">Secretaria Municipal de Educação</option>
                    </select>
                </div>
                <div>
                    <label for="jornada" class="block text-lg font-semibold mb-2">Qual é a sua jornada de trabalho?</label>
                    <select id="jornada" class="w-full p-3 rounded-md border border-gray-300 focus:ring-2 focus:ring-blue-500">
                        <option value="3">JEIF/JB 30/JB 40/JE 40</option>
                        <option value="2">JBD</option>
                        <option value="1">JB</option>
                    </select>
                </div>
            </div>

            <!-- Critérios de Desempenho -->
            <div id="criterios-container" class="space-y-8">
                <!-- Desempenho Individual -->
                <div class="bg-white p-6 rounded-lg shadow">
                     <h3 class="text-xl font-semibold mb-4 tooltip">
                        Desempenho Individual (1ª e 2ª Etapa)
                        <span class="tooltiptext">
                            <table>
                                <thead><tr><th>Faltas</th><th>%</th><th>Valor (Demais)</th><th>Valor (CEI)</th></tr></thead>
                                <tbody>
                                    <tr><td>0</td><td>100% + Bônus</td><td>R$ 1.200 + R$ 900</td><td>R$ 2.400 + R$ 900</td></tr>
                                    <tr><td>1</td><td>100%</td><td>R$ 1.200</td><td>R$ 2.400</td></tr>
                                    <tr><td>2</td><td>95%</td><td>R$ 1.140</td><td>R$ 2.280</td></tr>
                                    <tr><td>3</td><td>90%</td><td>R$ 1.080</td><td>R$ 2.160</td></tr>
                                    <tr><td>4</td><td>85%</td><td>R$ 1.020</td><td>R$ 2.040</td></tr>
                                    <tr><td>5</td><td>80%</td><td>R$ 960</td><td>R$ 1.920</td></tr>
                                    <tr><td>6</td><td>75%</td><td>R$ 900</td><td>R$ 1.800</td></tr>
                                    <tr><td>7</td><td>70%</td><td>R$ 840</td><td>R$ 1.680</td></tr>
                                    <tr><td>8</td><td>65%</td><td>R$ 780</td><td>R$ 1.560</td></tr>
                                    <tr><td>9</td><td>60%</td><td>R$ 720</td><td>R$ 1.440</td></tr>
                                    <tr><td>10</td><td>55%</td><td>R$ 660</td><td>R$ 1.320</td></tr>
                                    <tr><td>>10</td><td>0%</td><td>R$ 0</td><td>R$ 0</td></tr>
                                </tbody>
                            </table>
                            *Valores por semestre.
                        </span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="faltas1" class="block font-medium mb-1">Número de faltas no 1º semestre</label>
                            <input type="number" id="faltas1" class="w-full p-2 rounded-md border border-gray-300" value="0" min="0">
                        </div>
                        <div>
                            <label for="faltas2" class="block font-medium mb-1">Número de faltas no 2º semestre</label>
                            <input type="number" id="faltas2" class="w-full p-2 rounded-md border border-gray-300" value="0" min="0">
                        </div>
                    </div>
                </div>

                <!-- Desempenho Coletivo -->
                <div id="desempenho-coletivo" class="bg-white p-6 rounded-lg shadow">
                    <!-- Conteúdo dinâmico aqui -->
                </div>

                <!-- Bônus -->
                <div id="bonus-container" class="bg-white p-6 rounded-lg shadow">
                     <!-- Conteúdo dinâmico aqui -->
                </div>

            </div>

            <!-- Resultados -->
            <div id="resultados" class="mt-10 bg-white p-8 rounded-lg shadow-inner">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">Resultado da Simulação</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-lg">
                    <p>Valor estimado da 1ª etapa:</p><p class="font-semibold text-right" id="resultadoEtapa1">R$ 0,00</p>
                    <p>Bônus estimado da 1ª etapa:</p><p class="font-semibold text-right" id="resultadoBonus1">R$ 0,00</p>
                    <p>Valor estimado da 2ª etapa:</p><p class="font-semibold text-right" id="resultadoEtapa2">R$ 0,00</p>
                    <p>Bônus estimado da 2ª etapa:</p><p class="font-semibold text-right" id="resultadoBonus2">R$ 0,00</p>
                </div>
                <hr class="my-6">
                <div class="text-center">
                    <p class="text-xl font-medium">Soma dos valores estimados do PDE 2025:</p>
                    <p class="text-4xl font-extrabold text-blue-600 my-2" id="resultadoTotal">R$ 0,00</p>
                    <p class="text-md text-gray-600" id="resultadoMaximo">Valor máximo possível: R$ 0,00</p>
                </div>
                <div class="mt-8 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md">
                    <p class="font-bold">Aviso Importante</p>
                    <p class="text-sm">Os valores exibidos são apenas para fins de simulação. Os valores efetivamente pagos considerarão o texto do decreto publicado no Diário Oficial da Cidade e os dados processados pela Secretaria Municipal de Educação (SME) com base nas informações disponíveis nos sistemas da Prefeitura Municipal de São Paulo.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Elementos do DOM
        const cargoEl = document.getElementById('cargo');
        const localTrabalhoEl = document.getElementById('localTrabalho');
        const jornadaEl = document.getElementById('jornada');
        const faltas1El = document.getElementById('faltas1');
        const faltas2El = document.getElementById('faltas2');
        const desempenhoColetivoContainer = document.getElementById('desempenho-coletivo');
        const bonusContainer = document.getElementById('bonus-container');

        // Elementos de resultado
        const resultadoEtapa1El = document.getElementById('resultadoEtapa1');
        const resultadoBonus1El = document.getElementById('resultadoBonus1');
        const resultadoEtapa2El = document.getElementById('resultadoEtapa2');
        const resultadoBonus2El = document.getElementById('resultadoBonus2');
        const resultadoTotalEl = document.getElementById('resultadoTotal');
        const resultadoMaximoEl = document.getElementById('resultadoMaximo');

        // Constantes de valores máximos
        const VALOR_MAX_ETAPA = 3000;
        const VALOR_MAX_BONUS1 = 900;
        const VALOR_MAX_BONUS2_GERAL = 1800;
        const VALOR_MAX_BONUS2_DIRETORIA = 5800;

        // Adiciona listeners
        [cargoEl, localTrabalhoEl, jornadaEl, faltas1El, faltas2El].forEach(el => {
            el.addEventListener('change', () => {
                updateUI();
                calculate();
            });
        });

        function updateUI() {
            const local = localTrabalhoEl.value;
            const cargo = cargoEl.value;

            // --- Atualiza Desempenho Coletivo ---
            let htmlColetivo = `<h3 class="text-xl font-semibold mb-4">Desempenho Coletivo</h3>`;
            switch (local) {
                case '1': // EMEF/EMEFM
                    htmlColetivo += `
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold tooltip">
                                    1ª Etapa
                                    <span class="tooltiptext">
                                        <strong>Frequência:</strong><br>
                                        >= 90%: 100% (R$ 300)<br>
                                        85-89.99%: 75% (R$ 225)<br>
                                        80-84.99%: 50% (R$ 150)<br>
                                        75-79.99%: 25% (R$ 75)<br>
                                        < 75%: 0% (R$ 0)<br>
                                        <strong>Evolução Prova SP:</strong><br>
                                        Aumento: 100% (R$ 1.500)<br>
                                        Igual/Menor: 0% (R$ 0)
                                    </span>
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div>
                                        <label for="coletivo_freq_1" class="block font-medium mb-1">Frequência dos estudantes (%)</label>
                                        <input type="number" id="coletivo_freq_1" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                                    </div>
                                    <div>
                                        <label class="block font-medium mb-1">Evolução na Prova São Paulo (2024 para 2025)</label>
                                        <select id="coletivo_evolucao_1" class="w-full p-2 rounded-md border"><option value="1">Sim</option><option value="0">Não</option></select>
                                    </div>
                                </div>
                            </div>
                             <div>
                                <h4 class="font-semibold tooltip">
                                    2ª Etapa
                                     <span class="tooltiptext">
                                        <strong>Frequência:</strong><br>
                                        (Mesmas faixas da 1ª etapa)<br>
                                        <strong>Participação Prova SP/SARESP:</strong><br>
                                        >= 80% em ambas: 100% (R$ 1.500)<br>
                                        < 80% em uma delas: 0% (R$ 0)
                                    </span>
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                    <div>
                                        <label for="coletivo_freq_2" class="block font-medium mb-1">Frequência dos estudantes (%)</label>
                                        <input type="number" id="coletivo_freq_2" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                                    </div>
                                    <div>
                                        <label class="block font-medium mb-1">Participação >= 80% na Prova SP e SARESP 2025</label>
                                        <select id="coletivo_participacao_2" class="w-full p-2 rounded-md border"><option value="1">Sim</option><option value="0">Não</option></select>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    break;
                case '2': // EMEI/CEMEI
                     htmlColetivo += `
                        <div class="space-y-4">
                            <div class="tooltip">
                                <label for="coletivo_freq_1" class="block font-medium mb-1">Frequência dos estudantes (%) - 1º Semestre</label>
                                <span class="tooltiptext">
                                    >= 90%: 100% (R$ 1.800)<br>
                                    80-89.99%: 80% (R$ 1.440)<br>
                                    70-79.99%: 65% (R$ 1.170)<br>
                                    60-69.99%: 50% (R$ 900)<br>
                                    < 60%: 0% (R$ 0)
                                </span>
                            </div>
                            <input type="number" id="coletivo_freq_1" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                             <div class="tooltip">
                                <label for="coletivo_freq_2" class="block font-medium mb-1">Frequência dos estudantes (%) - 2º Semestre</label>
                                 <span class="tooltiptext">
                                    (Mesmas faixas do 1º Semestre)
                                </span>
                            </div>
                            <input type="number" id="coletivo_freq_2" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                        </div>`;
                    break;
                case '3': // CEI
                    htmlColetivo += `
                        <div class="space-y-4">
                            <div class="tooltip">
                                <label for="coletivo_ocupacao_1" class="block font-medium mb-1">Taxa de ocupação (%) - 1ª Etapa</label>
                                <span class="tooltiptext">
                                    >= 90%: 100% (R$ 600)<br>
                                    80-89.99%: 50% (R$ 300)<br>
                                    70-79.99%: 30% (R$ 180)<br>
                                    < 70%: 0% (R$ 0)
                                </span>
                            </div>
                            <input type="number" id="coletivo_ocupacao_1" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                             <div class="tooltip">
                                <label for="coletivo_ocupacao_2" class="block font-medium mb-1">Taxa de ocupação (%) - 2ª Etapa</label>
                                <span class="tooltiptext">(Mesmas faixas da 1ª Etapa)</span>
                            </div>
                            <input type="number" id="coletivo_ocupacao_2" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                        </div>`;
                    break;
                case '4': // CIEJA
                     htmlColetivo += `
                        <div class="space-y-4">
                            <div class="tooltip">
                                <label for="coletivo_ocupacao_1" class="block font-medium mb-1">Taxa de ocupação (%) - 1ª Etapa</label>
                                <span class="tooltiptext">
                                    >= 80%: 100% (R$ 1.800)<br>
                                    70-79.99%: 50% (R$ 900)<br>
                                    60-69.99%: 30% (R$ 540)<br>
                                    < 60%: 0% (R$ 0)
                                </span>
                            </div>
                            <input type="number" id="coletivo_ocupacao_1" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                             <div class="tooltip">
                                <label for="coletivo_ocupacao_2" class="block font-medium mb-1">Taxa de ocupação (%) - 2ª Etapa</label>
                                 <span class="tooltiptext">(Mesmas faixas da 1ª Etapa)</span>
                            </div>
                            <input type="number" id="coletivo_ocupacao_2" class="w-full p-2 rounded-md border" value="100" min="0" max="100">
                        </div>`;
                    break;
                case '7': // SME
                     htmlColetivo += `<p class="text-gray-600">O valor do desempenho coletivo será a média do desempenho coletivo de todas as DREs. Para a simulação, consideramos o valor máximo.</p>`;
                    break;
                default: // DRE, EMEBS, etc.
                    htmlColetivo += `<p class="text-gray-600">O valor do desempenho coletivo será a média do desempenho coletivo das unidades da respectiva DRE (ou todas as DREs para SME). Para a simulação, consideramos o valor máximo.</p>`;
                    break;
            }
            desempenhoColetivoContainer.innerHTML = htmlColetivo;

            // --- Atualiza Bônus ---
            let htmlBonus = `<h3 class="text-xl font-semibold mb-4">Bônus de Desempenho</h3>`;
            const isDiretoria = ['2', '3', '4'].includes(cargo); // Diretor, Assistente, Coordenador
            
            // Bônus Individual (Faltas)
            htmlBonus += `
                <div class="mb-6">
                    <h4 class="font-semibold">Bônus Individual (Assiduidade)</h4>
                    <div class="flex items-center mt-2">
                        <input type="checkbox" id="bonus_falta_zero_1" disabled class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="bonus_falta_zero_1" class="ml-2 text-gray-700">Zero falta no 1º semestre (Bônus de R$ 900,00)</label>
                    </div>
                     <div class="flex items-center mt-2">
                        <input type="checkbox" id="bonus_falta_zero_2" disabled class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="bonus_falta_zero_2" class="ml-2 text-gray-700">Zero falta no 2º semestre (Bônus de R$ 900,00)</label>
                    </div>
                </div>
            `;

            // Bônus Coletivo
            htmlBonus += `<h4 class="font-semibold mb-2">Bônus Coletivo (2ª Etapa)</h4>`;
            if (local === '1') { // EMEF/EMEFM
                htmlBonus += `
                    <div class="space-y-3">
                        <p class="text-sm text-gray-600">Regras de aumento do IDEP. Regra 1A e 1B não são cumulativas.</p>
                        <div class="custom-radio-container">
                             <label class="custom-radio-label">
                                <input type="radio" name="bonus_idep_regra1" value="1A" checked> Regra 1A: Aumento do IDEP acima da média
                            </label>
                            <label class="custom-radio-label">
                                <input type="radio" name="bonus_idep_regra1" value="1B"> Regra 1B: Aumento do IDEP e entre os 10% maiores
                            </label>
                             <label class="custom-radio-label">
                                <input type="radio" name="bonus_idep_regra1" value="none"> Nenhuma
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="bonus_idep_regra2" checked class="h-5 w-5 text-blue-600 border-gray-300 rounded">
                            <label for="bonus_idep_regra2" class="ml-2 text-gray-700">Regra 2: Aumento do IDEP com diminuição de estudantes abaixo do básico</label>
                        </div>
                `;
                if (isDiretoria) {
                    htmlBonus += `
                        <div class="flex items-center pt-2">
                            <input type="checkbox" id="bonus_alfabetizacao" checked class="h-5 w-5 text-blue-600 border-gray-300 rounded">
                            <label for="bonus_alfabetizacao" class="ml-2 text-gray-700">Aumento da % de estudantes alfabetizados no 2º ano (mín. 51%)</label>
                        </div>
                    `;
                }
                htmlBonus += `</div>`;
            } else if (['2', '3', '4'].includes(local)) { // EMEI/CEMEI, CEI, CIEJA
                htmlBonus += `
                    <div class="flex items-center">
                        <input type="checkbox" id="bonus_acima_media" checked class="h-5 w-5 text-blue-600 border-gray-300 rounded">
                        <label for="bonus_acima_media" class="ml-2 text-gray-700">Desempenho da unidade acima da média das unidades de seu tipo</label>
                    </div>
                `;
            } else { // DRE/SME/ETC
                htmlBonus += `<p class="text-gray-600">O bônus de desempenho da 2ª etapa seguirá as regras do decreto. Na estimativa, consideramos o valor máximo possível.</p>`;
            }
            bonusContainer.innerHTML = htmlBonus;
            
            // Adiciona listeners aos novos elementos
            document.querySelectorAll('#desempenho-coletivo input, #desempenho-coletivo select, #bonus-container input, #bonus-container select').forEach(el => {
                el.addEventListener('change', calculate);
            });

            // Lógica para desmarcar radios de bônus IDEP
            const radiosRegra1 = document.querySelectorAll('input[name="bonus_idep_regra1"]');
            radiosRegra1.forEach(radio => {
                radio.addEventListener('click', function(e) {
                    if (this.wasChecked) {
                        this.checked = false;
                        document.querySelector('input[name="bonus_idep_regra1"][value="none"]').checked = true;
                    }
                    this.wasChecked = this.checked;
                     calculate();
                });
            });


        }

        function calculate() {
            // --- Parâmetros Iniciais ---
            const cargo = cargoEl.value;
            const local = localTrabalhoEl.value;
            const jornada = parseFloat(jornadaEl.value);
            const isCEI = local === '3';
            const isDiretoria = ['2', '3', '4'].includes(cargo);

            let jornadaMultiplier = 1.0;
            if (jornada === 1) jornadaMultiplier = 0.5;
            if (jornada === 2) jornadaMultiplier = 0.75;

            // --- Desempenho Individual (Assiduidade) ---
            const faltas1 = parseInt(faltas1El.value) || 0;
            const faltas2 = parseInt(faltas2El.value) || 0;
            
            document.getElementById('bonus_falta_zero_1').checked = faltas1 === 0;
            document.getElementById('bonus_falta_zero_2').checked = faltas2 === 0;

            const baseIndividual = isCEI ? VALOR_MAX_ETAPA * 0.8 : VALOR_MAX_ETAPA * 0.4;
            
            const getIndividualValue = (faltas) => {
                if (faltas === 1) return baseIndividual;
                if (faltas === 2) return baseIndividual * 0.95;
                if (faltas === 3) return baseIndividual * 0.90;
                if (faltas === 4) return baseIndividual * 0.85;
                if (faltas === 5) return baseIndividual * 0.80;
                if (faltas === 6) return baseIndividual * 0.75;
                if (faltas === 7) return baseIndividual * 0.70;
                if (faltas === 8) return baseIndividual * 0.65;
                if (faltas === 9) return baseIndividual * 0.60;
                if (faltas === 10) return baseIndividual * 0.55;
                if (faltas > 10) return 0;
                return baseIndividual; // para 0 faltas (sem bônus)
            };

            let valorIndividual1 = getIndividualValue(faltas1);
            let valorIndividual2 = getIndividualValue(faltas2);
            let bonus1 = (faltas1 === 0) ? VALOR_MAX_BONUS1 : 0;
            let bonus2Assiduidade = (faltas2 === 0) ? VALOR_MAX_BONUS1 : 0;

            // --- Desempenho Coletivo ---
            const baseColetivo = isCEI ? VALOR_MAX_ETAPA * 0.2 : VALOR_MAX_ETAPA * 0.6;
            let valorColetivo1 = baseColetivo;
            let valorColetivo2 = baseColetivo;

            switch (local) {
                case '1': // EMEF/EMEFM
                    const freq1 = parseFloat(document.getElementById('coletivo_freq_1')?.value || 100);
                    const evolucao1 = document.getElementById('coletivo_evolucao_1')?.value === '1';
                    const freq2 = parseFloat(document.getElementById('coletivo_freq_2')?.value || 100);
                    const participacao2 = document.getElementById('coletivo_participacao_2')?.value === '1';

                    let freq1Val = 0;
                    if (freq1 >= 90) freq1Val = 300;
                    else if (freq1 >= 85) freq1Val = 225;
                    else if (freq1 >= 80) freq1Val = 150;
                    else if (freq1 >= 75) freq1Val = 75;
                    
                    let freq2Val = 0;
                    if (freq2 >= 90) freq2Val = 300;
                    else if (freq2 >= 85) freq2Val = 225;
                    else if (freq2 >= 80) freq2Val = 150;
                    else if (freq2 >= 75) freq2Val = 75;

                    valorColetivo1 = freq1Val + (evolucao1 ? 1500 : 0);
                    valorColetivo2 = freq2Val + (participacao2 ? 1500 : 0);
                    break;
                case '2': // EMEI/CEMEI
                    const freqEmei1 = parseFloat(document.getElementById('coletivo_freq_1')?.value || 100);
                    const freqEmei2 = parseFloat(document.getElementById('coletivo_freq_2')?.value || 100);
                    
                    const getEmeiValue = (freq) => {
                        if (freq >= 90) return 1800;
                        if (freq >= 80) return 1440;
                        if (freq >= 70) return 1170;
                        if (freq >= 60) return 900;
                        return 0;
                    };
                    valorColetivo1 = getEmeiValue(freqEmei1);
                    valorColetivo2 = getEmeiValue(freqEmei2);
                    break;
                case '3': // CEI
                    const ocupacaoCei1 = parseFloat(document.getElementById('coletivo_ocupacao_1')?.value || 100);
                    const ocupacaoCei2 = parseFloat(document.getElementById('coletivo_ocupacao_2')?.value || 100);

                    const getCeiValue = (ocupacao) => {
                        if (ocupacao >= 90) return 600;
                        if (ocupacao >= 80) return 300;
                        if (ocupacao >= 70) return 180;
                        return 0;
                    };
                    valorColetivo1 = getCeiValue(ocupacaoCei1);
                    valorColetivo2 = getCeiValue(ocupacaoCei2);
                    break;
                case '4': // CIEJA
                    const ocupacaoCieja1 = parseFloat(document.getElementById('coletivo_ocupacao_1')?.value || 100);
                    const ocupacaoCieja2 = parseFloat(document.getElementById('coletivo_ocupacao_2')?.value || 100);
                    
                     const getCiejaValue = (ocupacao) => {
                        if (ocupacao >= 80) return 1800;
                        if (ocupacao >= 70) return 900;
                        if (ocupacao >= 60) return 540;
                        return 0;
                    };
                    valorColetivo1 = getCiejaValue(ocupacaoCieja1);
                    valorColetivo2 = getCiejaValue(ocupacaoCieja2);
                    break;
                // Casos 5, 6, 7 usam o valor máximo por padrão na simulação
            }

            // --- Bônus Coletivo (Etapa 2) ---
            let bonus2Coletivo = 0;
            if (local === '1') { // EMEF/EMEFM
                const regra1A = document.querySelector('input[name="bonus_idep_regra1"][value="1A"]')?.checked;
                const regra1B = document.querySelector('input[name="bonus_idep_regra1"][value="1B"]')?.checked;
                const regra2 = document.getElementById('bonus_idep_regra2')?.checked;
                const bonusAlfabetizacao = document.getElementById('bonus_alfabetizacao')?.checked;

                const baseBonusColetivo = isDiretoria ? 1450 : 450;
                
                if (regra1A || regra1B) {
                    bonus2Coletivo += baseBonusColetivo;
                }
                if (regra2) {
                    bonus2Coletivo += baseBonusColetivo;
                }
                if (isDiretoria && bonusAlfabetizacao) {
                    bonus2Coletivo += 2000;
                }
            } else if (['2', '3', '4'].includes(local)) { // EMEI/CEMEI, CEI, CIEJA
                const acimaMedia = document.getElementById('bonus_acima_media')?.checked;
                if (acimaMedia) {
                    bonus2Coletivo = 900;
                }
            } else { // DRE/SME/ETC
                 // Para simulação, consideramos o bônus máximo para esses locais
                 bonus2Coletivo = isDiretoria ? VALOR_MAX_BONUS2_DIRETORIA - VALOR_MAX_BONUS1 : VALOR_MAX_BONUS2_GERAL - VALOR_MAX_BONUS1;
            }

            // --- Consolidação e Aplicação da Jornada ---
            const etapa1 = (valorIndividual1 + valorColetivo1);
            const etapa2 = (valorIndividual2 + valorColetivo2);
            const bonus2 = bonus2Assiduidade + bonus2Coletivo;

            const etapa1Final = etapa1 * jornadaMultiplier;
            const bonus1Final = bonus1 * jornadaMultiplier;
            const etapa2Final = etapa2 * jornadaMultiplier;
            const bonus2Final = bonus2 * jornadaMultiplier;
            const totalFinal = etapa1Final + bonus1Final + etapa2Final + bonus2Final;

            // --- Cálculo do Valor Máximo Possível ---
            let maxBonus2 = isDiretoria && local === '1' ? VALOR_MAX_BONUS2_DIRETORIA : VALOR_MAX_BONUS2_GERAL;
            if (['5','6','7'].includes(local)) { // DRE, SME, etc.
                 maxBonus2 = VALOR_MAX_BONUS2_GERAL;
            }

            const maxTotal = (VALOR_MAX_ETAPA + VALOR_MAX_BONUS1 + VALOR_MAX_ETAPA + maxBonus2) * jornadaMultiplier;


            // --- Atualiza a Tela ---
            resultadoEtapa1El.textContent = etapa1Final.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            resultadoBonus1El.textContent = bonus1Final.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            resultadoEtapa2El.textContent = etapa2Final.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            resultadoBonus2El.textContent = bonus2Final.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            resultadoTotalEl.textContent = totalFinal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            resultadoMaximoEl.textContent = `Valor máximo possível: ${maxTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            updateUI();
            calculate();
        });
    </script>

</body>
</html>